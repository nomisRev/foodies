{"id":"bd-19f","title":"Configure cross-namespace service access for Keycloak: Keycloak in keycloak namespace needs to access keycloak-postgres.foodies.svc.cluster.local and rabbitmq.foodies.svc.cluster.local","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T14:05:40.081814Z","created_by":"simonvergauwen","updated_at":"2026-01-23T14:05:40.081814Z","compaction_level":0,"original_size":0}
{"id":"bd-1gg","title":"Test Keycloak Realm Import CR works correctly","description":"Verify that the KeycloakRealmImport CR correctly creates the foodies-keycloak realm with all configured resources.\n\nVerification:\n1. Check realm import status: kubectl get keycloakrealmimport foodies-realm -n foodies -o yaml\n2. Verify realm exists via Admin API: kubectl exec -n foodies keycloak-0 -- /opt/keycloak/bin/kcadm.sh get realms/foodies-keycloak\n3. Verify client exists: kubectl exec -n foodies keycloak-0 -- /opt/keycloak/bin/kcadm.sh get clients -r foodies-keycloak -q clientId=foodies\n4. Verify user exists: kubectl exec -n foodies keycloak-0 -- /opt/keycloak/bin/kcadm.sh get users -r foodies-keycloak -q username=food3_lover\n5. Verify events listener is configured: kubectl exec -n foodies keycloak-0 -- /opt/keycloak/bin/kcadm.sh get realms/foodies-keycloak -o json | grep -o 'eventsListeners.*profile-webhook'\n\nExpected:\n- Realm import shows status Done\n- Realm foodies-keycloak exists\n- Client 'foodies' exists with correct redirect URIs\n- User 'food3_lover' exists with password 'password'\n- eventsListeners includes 'profile-webhook'\n\nFiles:\n- k8s/base/keycloak/keycloak-realm-import-cr.yaml","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T00:46:16.126009Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:46:16.126009Z","compaction_level":0,"original_size":0}
{"id":"bd-1lr","title":"Create production overlay for Keycloak Operator","description":"Create a production Kustomize overlay for the Keycloak Operator with production-appropriate settings.\n\nRequirements:\n- Production overlay at k8s/overlays/prod/\n- Image tag should be specific version (not latest)\n- Resource limits suitable for production\n- imagePullPolicy: Always\n- Secrets from external source (not hardcoded)\n- Separate PostgreSQL deployment (external DB)\n- Monitoring and observability:\n  - Prometheus ServiceMonitor\n  - Proper logging configuration\n  - Alerting rules\n\nFiles to create:\n- k8s/overlays/prod/kustomization.yaml\n- k8s/overlays/prod/keycloak-prod-patch.yaml\n- k8s/overlays/prod/monitoring.yaml\n\nReference:\n- k8s/overlays/dev/ for comparison\n- Keycloak Operator production best practices","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-23T00:46:41.832345Z","created_by":"simonvergauwen","updated_at":"2026-01-23T01:03:00.029355Z","closed_at":"2026-01-23T01:03:00.029313Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-1p4","title":"Install Keycloak Operator CRDs in foodies namespace","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:53:02.031980Z","created_by":"simonvergauwen","updated_at":"2026-01-23T09:47:33.760879Z","closed_at":"2026-01-23T09:47:33.760842Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-1q1","title":"Create KeycloakRealmImport CR for realm and identity configuration","description":"Create KeycloakRealmImport CR for realm and identity configuration - Replace init script job with KeycloakRealmImport CRD. Define realm, client, client scope, role, and user configuration","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T23:56:16.571092Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:02:02.676634Z","closed_at":"2026-01-23T00:02:02.676596Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-1qz","title":"Remove deprecated deployment.yaml and init script files after validation","description":"Clean up deprecated Keycloak configuration files once the Keycloak Operator migration has been validated and is working correctly.\n\nFiles to remove:\n1. k8s/base/keycloak/deployment.yaml - Old Deployment resource\n2. k8s/overlays/dev/deprecated/ directory and all contents:\n   - keycloak-config-job.yaml - Old init script job using kcadm.sh\n   - keycloak-realm-import-patch.yaml - Old realm import patch\n\nPrerequisites (must be completed before this task):\n- bd-359: Test complete Keycloak Operator migration (must pass all tests)\n- bd-384: Integrate Keycloak Operator installation (must be complete)\n- bd-1sv: Apply Keycloak CR and KeycloakRealmImport CR (must be working)\n\nSteps:\n1. Verify bd-359 tests pass and migration is fully functional\n2. Delete k8s/base/keycloak/deployment.yaml\n3. Delete k8s/overlays/dev/deprecated/ directory\n4. Update k8s/base/keycloak/README.md to remove references to deprecated files\n5. Verify namespace/foodies unchanged\nconfigmap/basket-config-9d9tk7679c unchanged\nconfigmap/foodies-config unchanged\nconfigmap/keycloak-config unchanged\nconfigmap/menu-config-6dhf4hm2dt unchanged\nconfigmap/order-config-54966g296f unchanged\nconfigmap/otel-collector-config-fthk92mk46 unchanged\nconfigmap/payment-config-8f5582bm7h unchanged\nconfigmap/profile-config-46kg259gmh unchanged\nconfigmap/prometheus-config unchanged\nconfigmap/rabbitmq-definitions unchanged\nconfigmap/webapp-config-5t2g8tmgg2 unchanged\nsecret/basket-rabbitmq-credentials-c5f89cm2dg unchanged\nsecret/keycloak-admin unchanged\nsecret/keycloak-rabbitmq-credentials unchanged\nsecret/menu-rabbitmq-credentials-mgh2th4cm7 unchanged\nsecret/order-rabbitmq-credentials-67mb6bh429 unchanged\nsecret/payment-rabbitmq-credentials-79bfk487kf unchanged\nsecret/postgres-credentials unchanged\nsecret/profile-rabbitmq-credentials-bc64c2fthd unchanged\nsecret/rabbitmq-credentials-t5mfgf8g4c unchanged\nsecret/webapp-auth-f4b4h8g97m unchanged\nservice/basket unchanged\nservice/jaeger unchanged\nservice/keycloak unchanged\nservice/keycloak-postgres unchanged\nservice/menu unchanged\nservice/menu-postgres unchanged\nservice/order unchanged\nservice/order-postgres unchanged\nservice/otel-collector unchanged\nservice/payment unchanged\nservice/payment-postgres unchanged\nservice/profile unchanged\nservice/profile-postgres unchanged\nservice/prometheus unchanged\nservice/rabbitmq unchanged\nservice/redis unchanged\nservice/webapp unchanged\npersistentvolumeclaim/prometheus-data unchanged\ndeployment.apps/basket unchanged\ndeployment.apps/jaeger unchanged\ndeployment.apps/menu unchanged\ndeployment.apps/order unchanged\ndeployment.apps/otel-collector unchanged\ndeployment.apps/payment unchanged\ndeployment.apps/profile unchanged\ndeployment.apps/prometheus unchanged\ndeployment.apps/redis unchanged\ndeployment.apps/webapp unchanged\nstatefulset.apps/keycloak-postgres configured\nstatefulset.apps/menu-postgres configured\nstatefulset.apps/order-postgres configured\nstatefulset.apps/payment-postgres configured\nstatefulset.apps/profile-postgres configured\nstatefulset.apps/rabbitmq configured\nkeycloakrealmimport.k8s.keycloak.org/foodies-realm created\ningress.networking.k8s.io/foodies-ingress unchanged still works\n\nDo NOT remove:\n- k8s/base/keycloak/keycloak-cr.yaml (new Keycloak CR)\n- k8s/base/keycloak/keycloak-realm-import-cr.yaml (new KeycloakRealmImport CR)\n- k8s/base/keycloak/keycloak.yaml (service)\n- k8s/base/keycloak/database.yaml (database)\n\nSafety check:\nBefore removing, confirm that all existing functionality still works with the new Operator-based setup.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T01:00:21.370325Z","created_by":"simonvergauwen","updated_at":"2026-01-23T13:16:48.067525Z","closed_at":"2026-01-23T13:16:48.067470Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-1sv","title":"Apply Keycloak CR and KeycloakRealmImport CR to configure Keycloak via Operator","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T00:53:02.599850Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:53:02.599850Z","compaction_level":0,"original_size":0}
{"id":"bd-20j","title":"Fix Keycloak custom image build configuration: Image built with specific kc.sh build options that conflict with operator runtime config. Need to align build-time and runtime configurations or rebuild image without build options","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T14:05:38.879702Z","created_by":"simonvergauwen","updated_at":"2026-01-23T14:05:38.879702Z","compaction_level":0,"original_size":0}
{"id":"bd-28y","title":"Update Keycloak documentation to reflect Operator-based deployment instead of init scripts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-23T00:53:09.505493Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:56:55.701149Z","closed_at":"2026-01-23T00:56:55.701106Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-2fl","title":"Verify Keycloak custom image with profile-webhook is deployed","description":"Ensure the custom foodies-keycloak image (version 0.0.5) with the profile-webhook event listener is correctly deployed and loaded.\n\nVerification steps:\n1. Build custom Keycloak image: ./gradlew :keycloak-rabbitmq-publisher:publishImageToLocalRegistry\n2. Verify image exists: docker images | grep foodies-keycloak\n3. Apply dev overlay: kubectl apply -k k8s/overlays/dev\n4. Check Keycloak pod is using correct image: kubectl get pod -n foodies -l app=keycloak -o jsonpath='{.items[0].spec.containers[0].image}'\n5. Verify profile-webhook provider is loaded: kubectl logs -n foodies keycloak-0 | grep 'profile-webhook'\n6. Verify RabbitMQ connection works: kubectl logs -n foodies keycloak-0 | grep 'RabbitMQ'\n\nExpected output:\n- Image should be foodies-keycloak:0.0.5 (or latest for dev)\n- Logs should show profile-webhook provider loaded\n- No RabbitMQ connection errors\n\nFiles:\n- keycloak/Dockerfile\n- keycloak-rabbitmq-publisher/build.gradle.kts\n- k8s/overlays/dev/kustomization.yaml","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T00:46:10.087756Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:46:10.087756Z","compaction_level":0,"original_size":0}
{"id":"bd-2t0","title":"Add imagePullPolicy configuration to Keycloak CR","description":"The current Keycloak CR does not specify imagePullPolicy, which may cause issues in development.\n\nCurrent state:\n- Old deployment.yaml had imagePullPolicy: IfNotPresent\n- Keycloak CR does not specify this setting\n\nAction required:\nAdd imagePullPolicy to ensure proper image handling in different environments:\n\nFor dev: IfNotPresent\nFor prod: Always (or as appropriate)\n\nFile to modify: k8s/base/keycloak/keycloak-cr.yaml","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-23T00:22:37.113146Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:47:54.149317Z","closed_at":"2026-01-23T00:47:54.149278Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-2xn","title":"Remove init script job (keycloak-config-job.yaml) after operator migration","description":"Remove init script job (keycloak-config-job.yaml) after operator migration - Delete keycloak-config-job.yaml and keycloak-realm-import-patch.yaml as they're replaced by KeycloakOperator CRs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T23:56:16.718255Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:02:02.677577Z","closed_at":"2026-01-23T00:02:02.677541Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-31c","title":"Document Keycloak Operator deployment and testing process","description":"Create comprehensive documentation for deploying and testing Keycloak Operator setup.\n\nContent needed:\n1. Prerequisites checklist\n2. Step-by-step Operator installation\n3. CR deployment process\n4. Verification steps\n5. Troubleshooting guide\n6. Rollback procedure\n\nCurrent documentation:\n- k8s/base/keycloak/README.md exists but needs updates for actual deployment\n\nAction required:\nUpdate k8s/base/keycloak/README.md with:\n- Actual Operator installation commands\n- Verification commands for CR status\n- Troubleshooting steps specific to Operator issues\n- How to check custom image is loaded\n- How to verify profile-webhook is working","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:22:44.184786Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:47:54.148108Z","closed_at":"2026-01-23T00:47:54.148068Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-349","title":"Document Keycloak Operator deployment process","description":"Create comprehensive documentation for deploying and managing Keycloak via the Operator.\n\nContent to add:\n1. README for k8s/base/keycloak-operator/\n2. README update for k8s/base/keycloak/ with Operator-based deployment\n3. Steps for installing CRDs and Operator\n4. How to apply CRs\n5. Verification commands\n6. Troubleshooting common issues:\n   - Operator not starting\n   - CR not being processed\n   - Custom image not loading\n   - Realm import failing\n7. Rollback procedure\n\nFiles to create/update:\n- k8s/base/keycloak-operator/README.md\n- k8s/base/keycloak/README.md (update for Operator)\n- docs/keycloak-operator.md (create new)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-23T00:46:38.826091Z","created_by":"simonvergauwen","updated_at":"2026-01-23T13:14:19.841649Z","closed_at":"2026-01-23T13:14:19.841612Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-359","title":"Test complete Keycloak Operator migration: verify realm, client, user, and RabbitMQ event listener work correctly","description":"Validate that the Keycloak Operator migration is fully functional by testing all key components.\n\nTest checklist:\n1. Operator deployment:\n   - Verify keycloak-operator pod is running in keycloak namespace\n   - Check operator logs for any errors\n\n2. Keycloak CR:\n   - Verify Keycloak pod is running in foodies namespace\n   - Check health/readiness probes are passing\n   - Verify hostname is configured correctly (foodies.local)\n   - Verify database connection is working\n\n3. Realm configuration (KeycloakRealmImport CR):\n   - Verify realm 'foodies-keycloak' exists\n   - Verify client 'foodies' exists with correct settings\n   - Verify client scope 'foodies-audience' exists\n   - Verify role 'user' exists\n\n4. User management:\n   - Verify user 'food3_lover' exists\n   - Test login with food_lover@gmail.com / password\n   - Verify user has 'user' role assigned\n\n5. Event listener:\n   - Verify profile-webhook event listener is configured\n   - Test that REGISTER event triggers RabbitMQ message\n   - Check RabbitMQ queue for events\n\n6. Integration:\n   - Test OAuth flow with foodies client\n   - Verify token contains foodies audience claim\n\nTools to use:\n- kubectl get pods -n keycloak (operator)\n- kubectl get pods -n foodies -l app=keycloak\n- kubectl get keycloak keycloak -n foodies\n- kubectl get keycloakrealmimport foodies-realm -n foodies\n- kubectl logs -n keycloak deployment/keycloak-operator\n- Access Keycloak Admin Console at http://foodies.local/auth\n\nExpected outcome:\nAll components are working correctly, no errors in logs, and the full authentication flow works end-to-end.\n\nDependencies:\n- bd-384: Integrate Keycloak Operator installation into main kustomization flow\n- bd-1sv: Apply Keycloak CR and KeycloakRealmImport CR to configure Keycloak via Operator\n- bd-1p4: Install Keycloak Operator CRDs in foodies namespace","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T01:00:08.140118Z","created_by":"simonvergauwen","updated_at":"2026-01-23T01:00:08.140118Z","compaction_level":0,"original_size":0}
{"id":"bd-384","title":"Integrate Keycloak Operator installation into main kustomization flow","description":"Add keycloak-operator resources to base kustomization so CRDs and operator are deployed automatically with namespace/foodies unchanged\nconfigmap/basket-config-9d9tk7679c unchanged\nconfigmap/foodies-config unchanged\nconfigmap/keycloak-config unchanged\nconfigmap/menu-config-6dhf4hm2dt unchanged\nconfigmap/order-config-54966g296f unchanged\nconfigmap/otel-collector-config-fthk92mk46 unchanged\nconfigmap/payment-config-8f5582bm7h unchanged\nconfigmap/profile-config-46kg259gmh unchanged\nconfigmap/prometheus-config unchanged\nconfigmap/rabbitmq-definitions unchanged\nconfigmap/webapp-config-5t2g8tmgg2 unchanged\nsecret/basket-rabbitmq-credentials-c5f89cm2dg unchanged\nsecret/keycloak-admin unchanged\nsecret/keycloak-rabbitmq-credentials unchanged\nsecret/menu-rabbitmq-credentials-mgh2th4cm7 unchanged\nsecret/order-rabbitmq-credentials-67mb6bh429 unchanged\nsecret/payment-rabbitmq-credentials-79bfk487kf unchanged\nsecret/postgres-credentials unchanged\nsecret/profile-rabbitmq-credentials-bc64c2fthd unchanged\nsecret/rabbitmq-credentials-t5mfgf8g4c unchanged\nsecret/webapp-auth-f4b4h8g97m unchanged\nservice/basket unchanged\nservice/jaeger unchanged\nservice/keycloak unchanged\nservice/keycloak-postgres unchanged\nservice/menu unchanged\nservice/menu-postgres unchanged\nservice/order unchanged\nservice/order-postgres unchanged\nservice/otel-collector unchanged\nservice/payment unchanged\nservice/payment-postgres unchanged\nservice/profile unchanged\nservice/profile-postgres unchanged\nservice/prometheus unchanged\nservice/rabbitmq unchanged\nservice/redis unchanged\nservice/webapp unchanged\npersistentvolumeclaim/prometheus-data unchanged\ndeployment.apps/basket unchanged\ndeployment.apps/jaeger unchanged\ndeployment.apps/menu unchanged\ndeployment.apps/order unchanged\ndeployment.apps/otel-collector unchanged\ndeployment.apps/payment unchanged\ndeployment.apps/profile unchanged\ndeployment.apps/prometheus unchanged\ndeployment.apps/redis unchanged\ndeployment.apps/webapp unchanged\nstatefulset.apps/keycloak-postgres configured\nstatefulset.apps/menu-postgres configured\nstatefulset.apps/order-postgres configured\nstatefulset.apps/payment-postgres configured\nstatefulset.apps/profile-postgres configured\nstatefulset.apps/rabbitmq configured\ningress.networking.k8s.io/foodies-ingress unchanged\n\nCurrent state:\n- keycloak-operator directory exists with namespace, CRDs, and operator deployment\n- CRDs are defined locally but not installed automatically\n- Manual operator installation required: namespace/keycloak created\ncustomresourcedefinition.apiextensions.k8s.io/keycloakrealmimports.k8s.keycloak.org created\ncustomresourcedefinition.apiextensions.k8s.io/keycloaks.k8s.keycloak.org created\nserviceaccount/keycloak-operator created\nclusterrole.rbac.authorization.k8s.io/keycloak-operator-clusterrole created\nclusterrolebinding.rbac.authorization.k8s.io/keycloak-operator-clusterrole-binding created\ndeployment.apps/keycloak-operator created\n\nRequired changes:\n- Add keycloak-operator to k8s/base/kustomization.yaml resources\n- Ensure proper namespace handling (operator runs in keycloak ns, CRs in foodies ns)\n- Verify CRDs are installed before Keycloak CRs are applied\n\nDependencies:\n- Keycloak CR (bd-1sv) depends on operator CRDs being installed first","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:59:50.040253Z","created_by":"simonvergauwen","updated_at":"2026-01-23T13:44:26.869714Z","closed_at":"2026-01-23T13:44:26.869683Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-38y","title":"Verify environment variable substitution works in Keycloak Operator","description":"The dev overlay uses environment variable substitution ($(FOODIES_HOST)) which may not work correctly with Keycloak Operator.\n\nCurrent state:\n- keycloak-env-patch.yaml has: KC_HOSTNAME: \"http://$(FOODIES_HOST)/auth\"\n- This pattern works in Kubernetes Deployment but may not work in CR\n\nAction required:\nTest if environment variable substitution works in Keycloak Operator CR. If not, use ConfigMap or Secret references directly.\n\nAlternatives:\n1. Use direct value from ConfigMap\n2. Use separate ConfigMap for hostname\n3. Use substitution in Kustomize patches\n\nFiles to check:\n- k8s/overlays/dev/keycloak-env-patch.yaml\n- k8s/base/keycloak/keycloak-cr.yaml","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:22:39.302583Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:47:54.147642Z","closed_at":"2026-01-23T00:47:54.147602Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-3bv","title":"Verify and fix health probes in Keycloak CR","description":"The current Keycloak CR has healthEnabled and metricsEnabled options, but may need explicit probe configuration.\n\nCurrent state:\n- keycloak-cr.yaml has healthEnabled: true and metricsEnabled: true\n- httpManagement.port: 9000 is configured\n- Old deployment.yaml had explicit probes:\n  - startupProbe on /health/started\n  - livenessProbe on /health/live\n  - readinessProbe on /health/ready\n\nAction required:\nVerify if Keycloak Operator automatically creates probes when healthEnabled is true. If not, add explicit probe configuration to podSpec.\n\nFile to check/modify: k8s/base/keycloak/keycloak-cr.yaml","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:22:24.322679Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:47:54.146593Z","closed_at":"2026-01-23T00:47:54.146548Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-3c9","title":"Remove deprecated deployment.yaml and init script files after validation","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-23T00:53:03.103644Z","created_by":"simonvergauwen","updated_at":"2026-01-23T01:03:00.028839Z","closed_at":"2026-01-23T01:03:00.028797Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-3cn","title":"Delete deprecated init script files after validation","description":"Remove the deprecated Keycloak configuration files after verifying the Operator-based setup works correctly.\n\nFiles to delete:\n- k8s/base/keycloak/deployment.yaml (old manual deployment)\n- k8s/overlays/dev/deprecated/keycloak-realm-import-patch.yaml\n- k8s/overlays/dev/deprecated/keycloak-config-job.yaml\n\nAction: Delete these files once all Keycloak Operator CRs are verified working\n\nPrerequisites:\n- Keycloak Operator CRs verified working\n- Keycloak pod running and healthy\n- Realm imported correctly\n- All tests passing","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-23T00:46:22.989568Z","created_by":"simonvergauwen","updated_at":"2026-01-23T09:43:04.173145Z","closed_at":"2026-01-23T09:43:04.173005Z","compaction_level":0,"original_size":0}
{"id":"bd-3cr","title":"Set up local Docker registry for Keycloak development: Operator requires imagePullPolicy Always, need registry at localhost:5000 to serve custom foodies-keycloak image","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T14:02:38.808091Z","created_by":"simonvergauwen","updated_at":"2026-01-23T14:02:38.808091Z","compaction_level":0,"original_size":0}
{"id":"bd-3e6","title":"Create production overlay for Keycloak Operator","description":"Create a production overlay (k8s/overlays/prod/) for Keycloak Operator configuration with production-appropriate settings.\n\nCurrent state:\n- Dev overlay exists at k8s/overlays/dev/\n- Dev overlay has keycloak-env-patch.yaml for dev-specific settings\n- Production overlay exists but may not have Keycloak Operator specific patches\n\nProduction settings to configure:\n1. Image:\n   - Use production image tag instead of latest\n   - Set imagePullPolicy to Always\n\n2. Hostname:\n   - Configure production hostname (e.g., foodies.production.com)\n   - Update ingress for production domain\n\n3. Database:\n   - Use managed PostgreSQL service (RDS, Cloud SQL, etc.)\n   - Configure connection strings and secrets\n   - Set proper resource limits\n\n4. Security:\n   - Use production secrets (from secret management)\n   - Enable HTTPS/TLS\n   - Configure proper TLS certificates\n\n5. Resources:\n   - Increase CPU/memory limits for production\n   - Configure proper HPA settings\n   - Set appropriate pod disruption budgets\n\n6. High availability:\n   - Set instances > 1 for HA\n   - Configure database HA\n   - Enable health checks with appropriate thresholds\n\n7. Monitoring:\n   - Configure production metrics endpoints\n   - Set up alerting rules\n   - Enable distributed tracing\n\nFiles to create/modify:\n- k8s/overlays/prod/kustomization.yaml (add Keycloak patches if needed)\n- k8s/overlays/prod/keycloak-prod-patch.yaml (new file for production settings)\n\nExample production patch:\n\n\nDependencies:\n- Base Keycloak Operator setup must be working (bd-384)\n- Dev environment should be validated first (bd-359)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T01:00:38.361399Z","created_by":"simonvergauwen","updated_at":"2026-01-23T13:21:36.761832Z","closed_at":"2026-01-23T13:21:36.761781Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-3fn","title":"Test and validate Keycloak Operator CR configuration in dev environment","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:06:13.737406Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:47:54.145913Z","closed_at":"2026-01-23T00:47:54.145853Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-3hf","title":"Integrate Keycloak Operator installation into main kustomization flow","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:53:46.951242Z","created_by":"simonvergauwen","updated_at":"2026-01-23T01:03:00.027195Z","closed_at":"2026-01-23T01:03:00.027140Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-3l0","title":"Install Keycloak Operator in foodies namespace before applying CRs","description":"Install Keycloak Operator in foodies namespace - kubectl create namespace foodies && kubectl apply -f https://raw.githubusercontent.com/keycloak/keycloak-operator/main/kubernetes/target/kubernetes/operator/0.0.0/operator.yaml","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:01:44.095543Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:47:54.144709Z","closed_at":"2026-01-23T00:47:54.144655Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-3qd","title":"Configure Keycloak Operator to support local custom images: Operator hardcodes imagePullPolicy to Always, preventing local dev images. Need to push to local registry or patch mechanism","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T14:01:31.335055Z","created_by":"simonvergauwen","updated_at":"2026-01-23T14:01:31.335055Z","compaction_level":0,"original_size":0}
{"id":"bd-3r7","title":"Create Keycloak CR for server configuration","description":"Create Keycloak CR for server configuration - Replace deployment.yaml with Keycloak CRD (k8s.keycloak.org/v2alpha1). Configure hostname, HTTP, database, health metrics, and RabbitMQ integration","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T23:56:16.218838Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:02:02.675631Z","closed_at":"2026-01-23T00:02:02.675569Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-3sg","title":"Refactor Keycloak deployment to use Keycloak Operator","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T23:56:16.058590Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:02:02.678008Z","closed_at":"2026-01-23T00:02:02.677972Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-3vy","title":"Update Kustomize to use Keycloak Operator CRDs instead of Deployment","description":"Update Kustomize to use Keycloak Operator CRDs instead of Deployment - Update base kustomization to include Keycloak CR and KeycloakRealmImport CR. Remove init script job from dev overlay","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T23:56:17.185058Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:02:02.677124Z","closed_at":"2026-01-23T00:02:02.677088Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-4fz","title":"Delete deprecated init script files after validating Keycloak Operator setup works","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:06:17.979361Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:47:54.151729Z","closed_at":"2026-01-23T00:47:54.151693Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-61q","title":"Install and validate Keycloak Operator in dev environment","description":"Install Keycloak Operator CRDs and deployment in the keycloak namespace, then apply Keycloak CR and verify it works correctly.\n\nSteps:\n1. Apply CRDs: kubectl apply -f https://raw.githubusercontent.com/keycloak/keycloak-k8s-resources/26.5.1/kubernetes/keycloaks.k8s.keycloak.org-v1.yml\n2. Apply CRDs: kubectl apply -f https://raw.githubusercontent.com/keycloak/keycloak-k8s-resources/26.5.1/kubernetes/keycloakrealmimports.k8s.keycloak.org-v1.yml\n3. Create keycloak namespace\n4. Apply operator deployment from k8s/base/keycloak-operator/kustomization.yaml\n5. Verify operator pod is running\n6. Apply base keycloak resources\n7. Verify Keycloak pod starts successfully\n8. Verify realm is imported correctly\n9. Verify profile-webhook listener is loaded in logs\n\nFiles involved:\n- k8s/base/keycloak-operator/\n- k8s/base/keycloak/\n- k8s/overlays/dev/\n\nValidation:\n- kubectl get keycloak -n foodies\n- kubectl get keycloakrealmimport -n foodies\n- kubectl logs -n keycloak keycloak-operator\n- kubectl logs -n foodies keycloak-0","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T00:46:05.975377Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:46:05.975377Z","compaction_level":0,"original_size":0}
{"id":"bd-axw","title":"Configure resource limits and requests in Keycloak CR","description":"The current Keycloak CR does not include CPU and memory resource limits/requests.\n\nCurrent state:\n- keycloak-cr.yaml has no resource configuration\n- Old deployment.yaml had:\n  - requests: memory: 512Mi, cpu: 200m\n  - limits: memory: 1Gi, cpu: 1000m\n\nAction required:\nAdd resource configuration to Keycloak CR using podSpec:\n\n```yaml\nspec:\n  keycloakDeploymentSpec:\n    podSpec:\n      containers:\n        - name: keycloak\n          resources:\n            requests:\n              memory: \"512Mi\"\n              cpu: \"200m\"\n            limits:\n              memory: \"1Gi\"\n              cpu: \"1000m\"\n```\n\nFile to modify: k8s/base/keycloak/keycloak-cr.yaml","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-23T00:22:22.466328Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:47:54.148724Z","closed_at":"2026-01-23T00:47:54.148676Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-dbo","title":"Add monitoring and observability for Keycloak Operator","description":"Ensure Keycloak Operator deployment is properly monitored.\n\nCurrent state:\n- Old deployment.yaml had metricsEnabled: true\n- Keycloak CR also has metricsEnabled: true\n\nAction required:\n1. Verify Prometheus ServiceMonitor is configured for Keycloak metrics\n2. Ensure metrics endpoint is accessible (port 9000)\n3. Add Keycloak Operator metrics to monitoring stack\n4. Create dashboards for Keycloak Operator status\n\nFiles to check:\n- k8s/base/prometheus/configmap.yaml\n- Any existing ServiceMonitor resources","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-23T00:22:47.622417Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:47:54.151221Z","closed_at":"2026-01-23T00:47:54.151180Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-i1r","title":"Ensure custom Keycloak image with profile-webhook is used","description":"The custom foodies-keycloak image includes the profile-webhook event listener that sends events to RabbitMQ.\n\nCurrent state:\n- Dev overlay overrides foodies-keycloak image tag to latest\n- Keycloak Operator may default to using standard quay.io/keycloak/keycloak:latest image\n- Custom image location: keycloak-rabbitmq-publisher module\n\nAction required:\nEnsure the Keycloak CR explicitly uses the custom foodies-keycloak image that includes the ProfileWebhookEventListener.\n\nPossible solutions:\n1. Add image override in CR spec\n2. Use ImagePullPolicy and ensure custom image is in registry\n3. Use Kustomize image transformer (already in dev overlay)\n\nFiles to check:\n- k8s/base/keycloak/keycloak-cr.yaml\n- k8s/overlays/dev/kustomization.yaml\n\nVerification:\nAfter deployment, verify profile-webhook listener is loaded by checking Keycloak logs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:22:31.015931Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:47:54.147166Z","closed_at":"2026-01-23T00:47:54.147125Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-izz","title":"Review and validate hostname configuration for Keycloak Operator","description":"The hostname configuration needs validation for Keycloak Operator deployment.\n\nCurrent state:\n- KC_HOSTNAME is set to \"http://$(FOODIES_HOST)/auth\" in dev overlay\n- KC_HOSTNAME_ADMIN is set to \"http://$(FOODIES_HOST)/auth\"\n- keycloak-cr.yaml has hostname configuration but may not match\n\nPotential issues:\n1. Environment variable substitution ($(FOODIES_HOST)) may not work in CR\n2. Hostname format may need adjustment for Operator\n3. Operator expects hostname field in spec, not just env vars\n\nAction required:\nReview Keycloak Operator documentation and ensure hostname is correctly configured.\n\nFiles to check:\n- k8s/base/keycloak/keycloak-cr.yaml\n- k8s/overlays/dev/keycloak-env-patch.yaml\n- k8s/base/keycloak/kustomization.yaml (keycloak-config ConfigMap)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-23T00:22:33.637011Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:47:54.149787Z","closed_at":"2026-01-23T00:47:54.149750Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-qxr","title":"Create Kustomize overlay for production Keycloak Operator configuration","description":"The production overlay needs to be created or updated for Keycloak Operator deployment.\n\nCurrent state:\n- k8s/overlays/prod/kustomization.yaml exists\n- May need Keycloak-specific patches for production\n\nAction required:\n1. Create or update k8s/overlays/prod/keycloak-patches.yaml with:\n   - Production hostname configuration\n   - Production resource limits (if different)\n   - ImagePullPolicy: Always or appropriate setting\n   - Any production-specific env vars\n\n2. Ensure production overlay includes Keycloak CR patches","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-23T00:22:46.026022Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:47:54.150573Z","closed_at":"2026-01-23T00:47:54.150524Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-v9j","title":"Test complete Keycloak Operator migration: verify realm, client, user, and RabbitMQ event listener work correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:53:08.771300Z","created_by":"simonvergauwen","updated_at":"2026-01-23T01:03:00.028241Z","closed_at":"2026-01-23T01:03:00.028189Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-wl6","title":"Test Keycloak health and readiness probes in dev","description":"Verify that the health, liveness, and readiness probes configured in the Keycloak CR work correctly.\n\nTests:\n1. Check startup probe passes: kubectl wait --for=condition=ready pod -l app=keycloak -n foodies --timeout=300s\n2. Test health endpoint: kubectl exec -n foodies keycloak-0 -- curl http://localhost:9000/health/live\n3. Test ready endpoint: kubectl exec -n foodies keycloak-0 -- curl http://localhost:9000/health/ready\n4. Test started endpoint: kubectl exec -n foodies keycloak-0 -- curl http://localhost:9000/health/started\n5. Verify metrics endpoint: kubectl exec -n foodies keycloak-0 -- curl http://localhost:9000/metrics\n\nExpected:\n- All health endpoints return 200\n- Pod becomes Ready within 5 minutes\n- Metrics endpoint returns Prometheus metrics\n\nFiles:\n- k8s/base/keycloak/keycloak-cr.yaml (probes configuration)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T00:46:12.646464Z","created_by":"simonvergauwen","updated_at":"2026-01-23T00:46:12.646464Z","compaction_level":0,"original_size":0}
