{"id":"bd-1cq","title":"SECURITY: Hardcoded test user password in config job","description":"The keycloak-config-job.yaml hardcodes a test user password 'password' in plaintext (lines 229, 242). While this is a test user, it's poor practice and could be accidentally used in production.\n\nLocation: k8s/overlays/dev/keycloak-config-job.yaml:229,242\n\nRecommendation:\n- Store test credentials in Kubernetes Secrets\n- Use environment variables to inject them\n- Document that these are dev-only credentials\n- Consider using random generated passwords even for dev\n\nImpact: Medium - Sets bad precedent and could leak to production","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T17:59:43.445965Z","created_by":"simonvergauwen","updated_at":"2026-01-23T20:44:24.227877Z","closed_at":"2026-01-23T20:44:24.227853Z","close_reason":"Security fixes implemented: moved secrets to Kubernetes secrets, fixed start-dev mode, added security contexts, improved init container","compaction_level":0,"original_size":0}
{"id":"bd-1kg","title":"Missing network policies for Keycloak","description":"No NetworkPolicy resources are defined to restrict traffic to/from Keycloak pods.\n\nCurrent state:\n- Keycloak can communicate with any pod in the cluster\n- Any pod can access Keycloak database directly\n- No ingress/egress restrictions\n\nRecommendations:\nCreate NetworkPolicies to:\n- Allow only ingress controller to access Keycloak service\n- Allow Keycloak to access only PostgreSQL and RabbitMQ\n- Deny direct access to Keycloak PostgreSQL from other pods\n- Implement least-privilege network access\n\nImpact: Medium - Increases blast radius if any pod is compromised","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T18:00:56.320520Z","created_by":"simonvergauwen","updated_at":"2026-01-23T18:01:02.390213Z","compaction_level":0,"original_size":0}
{"id":"bd-2gf","title":"PostgreSQL database lacks persistent volume for production","description":"The Keycloak PostgreSQL StatefulSet has a volumeClaimTemplate with only 1Gi storage, which may be insufficient for production use.\n\nLocation: k8s/base/keycloak/database.yaml:75-82\n\nCurrent configuration:\n- 1Gi storage allocation\n- No storageClassName specified (uses default)\n- accessMode: ReadWriteOnce (correct)\n\nRecommendations:\n- Consider larger storage for production (5-10Gi minimum)\n- Explicitly specify storageClassName for predictability\n- Document storage requirements in README\n- Consider backup strategy for the PVC\n- Add resource monitoring/alerts for disk usage\n\nImpact: Low for dev, High for production - Data loss risk if storage fills up","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T18:00:45.122143Z","created_by":"simonvergauwen","updated_at":"2026-01-23T18:00:52.523945Z","compaction_level":0,"original_size":0}
{"id":"bd-2y5","title":"Job uses shell script instead of declarative Keycloak configuration","description":"The Keycloak configuration is done via a 250-line shell script in a Job rather than using Keycloak's declarative realm import feature or Kubernetes operator.\n\nLocation: k8s/overlays/dev/keycloak-config-job.yaml:46-258\n\nIssues:\n- Shell script is brittle and error-prone\n- Difficult to test and maintain\n- No idempotency guarantees beyond manual checks\n- Complex JSON parsing with grep/sed is fragile\n- Mixes configuration logic with deployment\n\nRecommendations:\n- Use Keycloak's realm import feature (import realm JSON file)\n- Consider using Keycloak Operator for Kubernetes\n- Store realm configuration as declarative YAML/JSON\n- Mount configuration as ConfigMap volume\n- Let Keycloak handle the import on startup\n\nImpact: Medium - Makes configuration harder to maintain and test, increases risk of errors\n\nReference: Keycloak supports --import-realm flag to import realm JSON on startup","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T18:00:21.594925Z","created_by":"simonvergauwen","updated_at":"2026-01-23T18:00:30.366835Z","compaction_level":0,"original_size":0}
{"id":"bd-37k","title":"Job completion doesn't prevent rerun without proper idempotency","description":"The keycloak-config Job can be rerun multiple times, and while it has some idempotency checks, it relies on brittle shell logic.\n\nLocation: k8s/overlays/dev/keycloak-config-job.yaml\n\nIssues:\n- ttlSecondsAfterFinished: 100 means job pods are auto-deleted quickly\n- Each rerun executes the entire shell script\n- Idempotency depends on kcadm.sh responses being parseable\n- No mechanism to skip if configuration is already correct\n- Could cause issues if run against production by mistake\n\nRecommendations:\n- Consider using a ConfigMap to track configuration version\n- Use Helm hooks or ArgoCD sync waves for better lifecycle management\n- Add a dry-run mode\n- Store desired state declaratively and compare before applying\n- Consider making this an init container instead of a separate Job\n\nImpact: Low - Mostly works but could fail in edge cases or cause confusion","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T18:01:17.257670Z","created_by":"simonvergauwen","updated_at":"2026-01-23T18:01:26.061059Z","compaction_level":0,"original_size":0}
{"id":"bd-5dc","title":"Using 'start-dev' mode in production-capable configuration","description":"Keycloak is configured with 'start-dev' mode (deployment.yaml:19, keycloak-realm-import-patch.yaml:10), which disables many security features including TLS.\n\nLocation: \n- k8s/base/keycloak/deployment.yaml:19\n- k8s/overlays/dev/keycloak-realm-import-patch.yaml:10\n\nIssues with start-dev:\n- Disables HTTPS/TLS requirements\n- Relaxes security policies\n- Not suitable for production\n- Should only be in dev overlay, not base\n\nRecommendation:\n- Move 'start-dev' args to dev overlay only\n- Use 'start' command for production\n- Configure proper TLS for production\n- Ensure base configuration is production-ready\n\nImpact: Critical if deployed to production - weakens security posture significantly","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T17:59:55.475166Z","created_by":"simonvergauwen","updated_at":"2026-01-23T20:44:24.228143Z","closed_at":"2026-01-23T20:44:24.228124Z","close_reason":"Security fixes implemented: moved secrets to Kubernetes secrets, fixed start-dev mode, added security contexts, improved init container","compaction_level":0,"original_size":0}
{"id":"bd-9yr","title":"Init container uses wget without proper error handling","description":"The init container in keycloak-config-job.yaml uses wget in a simple polling loop without proper error handling or timeouts.\n\nLocation: k8s/overlays/dev/keycloak-config-job.yaml:18-30\n\nIssues:\n- No maximum wait time (could loop forever)\n- wget failures aren't distinguished from service unavailability\n- Using wget --spider which may not respect all HTTP errors properly\n- No exponential backoff\n- busybox:1.36 image is fine but version should be pinned with digest\n\nRecommendations:\n- Add a maximum retry count or timeout\n- Use curl instead of wget (better error handling)\n- Add exponential backoff between retries\n- Consider using a dedicated wait-for tool\n- Pin image with digest: busybox:1.36@sha256:...\n\nImpact: Low - Could cause job to hang indefinitely if Keycloak never becomes ready","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T18:00:07.995825Z","created_by":"simonvergauwen","updated_at":"2026-01-23T20:44:24.228681Z","closed_at":"2026-01-23T20:44:24.228658Z","close_reason":"Security fixes implemented: moved secrets to Kubernetes secrets, fixed start-dev mode, added security contexts, improved init container","compaction_level":0,"original_size":0}
{"id":"bd-c8i","title":"Missing security context and pod security standards","description":"The Keycloak deployment and config job lack security contexts, which is a Kubernetes best practice for defense-in-depth.\n\nLocation: \n- k8s/base/keycloak/deployment.yaml (no securityContext)\n- k8s/overlays/dev/keycloak-config-job.yaml (no securityContext)\n\nMissing security controls:\n- No runAsNonRoot directive\n- No readOnlyRootFilesystem\n- No capabilities dropping\n- No seccompProfile\n- No runAsUser/runAsGroup\n\nRecommendations:\nAdd securityContext to both pod and container level:\n\n\nImpact: Medium - Reduces defense-in-depth, fails pod security standards (restricted)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T18:00:33.912339Z","created_by":"simonvergauwen","updated_at":"2026-01-23T20:44:24.228410Z","closed_at":"2026-01-23T20:44:24.228391Z","close_reason":"Security fixes implemented: moved secrets to Kubernetes secrets, fixed start-dev mode, added security contexts, improved init container","compaction_level":0,"original_size":0}
{"id":"bd-dnd","title":"Resource limits may be insufficient for production load","description":"Keycloak deployment has resource limits that may be too low for production workloads.\n\nLocation: k8s/base/keycloak/deployment.yaml:126-132\n\nCurrent limits:\n- Memory: 512Mi request, 1Gi limit\n- CPU: 200m request, 1000m limit\n\nIssues:\n- Keycloak typically needs 2-4Gi memory in production\n- JVM heap tuning not configured\n- Could cause OOMKills under load\n- No HorizontalPodAutoscaler defined\n\nRecommendations:\n- Increase memory to 2Gi request, 4Gi limit for production\n- Configure JVM heap size via JAVA_OPTS\n- Add HPA based on CPU/memory metrics\n- Load test to determine actual requirements\n- Consider separate resource profiles for dev/prod\n\nImpact: High for production - Could cause service instability under load","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T18:01:05.968497Z","created_by":"simonvergauwen","updated_at":"2026-01-23T18:01:12.856542Z","compaction_level":0,"original_size":0}
{"id":"bd-ips","title":"SECURITY: Hardcoded client secret in dev configuration","description":"The keycloak-config-job.yaml contains a hardcoded client secret 'foodies_client_secret' in line 183 and 199. This is a security risk even in development.\n\nLocation: k8s/overlays/dev/keycloak-config-job.yaml:183,199\n\nRecommendation:\n- Store client secret in a Kubernetes Secret\n- Reference it via environment variable in the Job\n- Never commit secrets to version control\n\nImpact: High - Credentials exposed in git history","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T17:59:19.146110Z","created_by":"simonvergauwen","updated_at":"2026-01-23T20:44:24.227008Z","closed_at":"2026-01-23T20:44:24.226983Z","close_reason":"Security fixes implemented: moved secrets to Kubernetes secrets, fixed start-dev mode, added security contexts, improved init container","compaction_level":0,"original_size":0}
